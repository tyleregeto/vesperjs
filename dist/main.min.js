var te=te||{};te.mentions={},te.escapeHtml=function(a){var b=document.createTextNode(a),c=document.createElement("div");return c.appendChild(b),c.innerHTML},te.parseTemplate=function(a,b,c){"string"==typeof a&&(a={value:a});for(var d=Object.keys(a),e=0;e<d.length;e++){var f=d[e],g=c?te.escapeHtml(a[f]):a[f];b=b.replace(new RegExp("{"+f+"}","g"),g)}return b},te.mentions.DeleteStyle={All:0,Text:1,Spaces:2},te.mentions.newListener=function(a,b){function c(){"string"==typeof a&&(a=document.getElementById(a)),m=a,"textarea"===m.tagName.toLowerCase()?n=te.mentions.newTextareaPlugin(m,b):m.hasAttribute("contentEditable")&&"false"!==m.getAttribute("contentEditable")&&(n=te.mentions.newContentEditablePlugin(m,b)),u=b.view||te.mentions.newListView(i,{className:n.name}),m.addEventListener("input",f),m.addEventListener("click",f),m.addEventListener("keydown",e)}function d(){m.removeEventListener("input",f),m.removeEventListener("click",f),m.removeEventListener("keydown",e),u.destory()}function e(a){var b={37:1,38:1,39:1,40:0};b[a.keyCode]&&f()}function f(){x||(x=!0,window.requestAnimationFrame?window.requestAnimationFrame(g):setTimeout(g,1e3/30))}function g(){x=!1;var a=n.getValue();if(a||(a={text:"",caretIndex:0}),w=a.data,v=j(a.text,a.caretIndex)){var b=v.term;z?Array.isArray(A[b])?u.setList(k(b,A[b]),n.getMenuPosition(v.start)):void 0===A[b]?(A[b]=!1,y(b,l.bind(this,b)),u.setList(h(b),n.getMenuPosition(v.start))):u.setList(h(b),n.getMenuPosition(v.start)):u.setList(k(b,y),n.getMenuPosition(v.start))}else u.setList([])}function h(a){for(var b=a;b.length>0;){if(A[b])return A[b];b=b.substr(0,b.length-1)}return[]}function i(a){var b=te.parseTemplate(a,p,t);n.insert(b,v,q,w)}function j(a,b){for(var c=0;r>c;){var d=a.substr(b-c,c+1);if(d[0]===o){if(s>=c)return!1;var e=a.substr(b-c+1,c-1),f=e.indexOf(o);return-1!==f&&(e=e.substr(0,f)),0>b-c?!1:{term:e,start:b-c,end:b}}c++}return!1}function k(a,b){a=a.toLowerCase();for(var c=[],d=0;d<b.length;d++){var e=b[d];e.substr(0,a.length).toLowerCase()===a&&c.push(e)}return c}function l(a,b){A[a]=b,f()}b=b||{};var m=null,n=null,o=b.triggerCharacter||"@",p=b.insertTmpl||o+"{value}",q=b.spaceAfterInsert||!1,r=b.maxLen||20,s=b.minLen||0,t=b.escapeTmpls!==!1,u=null,v=null,w=null,x=!1,y=b.data||[],z="function"==typeof y,A={};return c(),{destory:d}},te.mentions.newContentEditablePlugin=function(a,b){function c(a){i!==h.All&&8===a.keyCode&&a.preventDefault()}function d(){var b=window.getSelection(),c=b.getRangeAt(0);if(!c.collapsed)return!1;for(var d=b.anchorNode,e=null,f=!1,h=d;h&&(f=f||"A"===h.tagName,h!==a);){var i=h.className;if(i===g)e=h;else if(i&&-1!==i.indexOf(g))for(var j=i.split(" "),k=0;k<j.length;k++)if(j[k]===g){e=h;break}if(e)break;h=h.parentNode}if(!e&&f)return!1;var l={range:c,anchorNode:d,nodeToReplace:e};return{text:b.anchorNode.textContent,caretIndex:b.anchorOffset,data:l}}function e(a,b,c,d){var e=document.createElement("div");e.innerHTML=a,e=e.firstChild,e.contentEditable=!1;var f=d.range;d.nodeToReplace?f.selectNode(d.nodeToReplace):d.anchorNode.nodeType===Node.TEXT_NODE&&(f.setStart(d.anchorNode,b.start),f.setEnd(d.anchorNode,b.end)),f.deleteContents(),f.insertNode(e);var g=e;c&&(g=document.createTextNode("Â "),e.parentNode.insertBefore(g,e.nextSibling));var h=window.getSelection();h.removeAllRanges(),f=document.createRange(),f.selectNode(g.nextSibling),f.collapse(),h.addRange(f)}function f(a){var b=window.getSelection(),c=b.getRangeAt(0);c.cloneRange(),c.setStart(c.startContainer,a);var d=c.getBoundingClientRect();return{top:d.top+window.scrollY,left:d.left+window.scrollX}}var g=b.mentionParentClass||"te-mention",h=te.mentions.DeleteStyle,i=b.deleteStyle||h.All;return a.addEventListener("onkeydown",c),{name:"te-mention-content-editable",insert:e,getValue:d,getMenuPosition:f}},te.mentions.newListView=function(a,b){function c(){document.body.removeChild(n),window.removeEventListener("keydown",g)}function d(a,b){if(!(Date.now()-u<p)){for(k=a,j=a.length,m=j>0,l=[],i=0;o.firstChild;)o.removeChild(o.firstChild);if(!m)return void(n.style.display="none");n.style.top=b.top+"px",n.style.left=b.left+"px",n.style.display="block";for(var c=0;c<k.length;c++){var d=k[c],e=document.createElement("li");e.setAttribute("data-te-mention-index",c),0===c&&(e.className="te-active"),e.innerHTML=te.parseTemplate(d,q,t),o.appendChild(e),l.push(e)}}}function e(a,b){var c=null,d=i;if(i=a,0>i?i=0:i>j-1&&(i=j-1),d!==i){for(var e=0;e<l.length;e++)e===d?l[e].className="":e===i&&(c=l[e],c.className="te-active");if(c)if("function"==typeof c.scrollIntoViewIfNeeded)c.scrollIntoViewIfNeeded(!1);else{var f=b?"end":"start";c.scrollIntoView({block:f,behavior:"smooth"})}}}function f(b){var c=k[b];d([]),a(c)}function g(a){if(m){var b=!1;switch(a.keyCode){case 38:b=!0,e(i-1,!0);break;case 40:b=!0,e(i+1);break;case 13:s&&(b=!0,f(i));break;case 9:r&&(b=!0,f(i));break;case 27:d([]),u=Date.now()}b&&(a.stopImmediatePropagation(),a.preventDefault())}}function h(a){for(var b=a.target;b&&!b.hasAttribute("data-te-mention-index");)b=b.parentNode;b&&f(parseInt(b.getAttribute("data-te-mention-index"),10)),a.stopImmediatePropagation(),a.preventDefault()}var i=0,j=0,k=null,l=null,m=!1,n=document.createElement("div"),o=document.createElement("ul"),p=b.escapeCloseLength||3e3,q=b.rowTmpl||"{value}",r=b.tabSelects!==!1,s=b.enterSelects!==!1,t=b.escapeTmpls!==!1,u=0;return o.className="te-mentions-list-results",o.addEventListener("click",h),n.className="te-mentions-list "+(b.className||""),n.style.display="none",n.appendChild(o),document.body.appendChild(n),window.addEventListener("keydown",g,!0),{setList:d,destroy:c}},te.mentions.newTextareaPlugin=function(a){function b(){return{text:a.value,caretIndex:a.selectionStart}}function c(c,d,e){var f=b().text;e&&(c+=" "),a.value=f.slice(0,d.start)+c+f.slice(d.end);var g=d.start+c.length;a.selectionStart=g,a.selectionEnd=g}function d(){var b=a.getBoundingClientRect();return{top:b.bottom+window.scrollY,left:b.left+window.scrollX}}return{name:"te-mention-textarea",insert:c,getValue:b,getMenuPosition:d}};